<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>英語スピードリーディング</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      align-items: center;
      justify-content: center;
      padding: 12px;
    }
    h1 {
      margin: 0 0 8px;
      font-size: 16px;
      text-align: center;
      font-weight: 600;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      align-items: center;
      margin-bottom: 12px;
      font-size: 12px;
    }
    select, input[type="range"] {
      font-size: 12px;
    }
    select {
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #111;
      color: #fff;
      min-width: 180px;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      cursor: pointer;
      background: #2563eb;
      color: #fff;
    }
    .word-box {
      width: 100%;
      max-width: 600px;
      height: min(55vh, 260px);
      border-radius: 16px;
      border: 1px solid #222;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px 12px;
    }
    .word {
      font-size: clamp(24px, 5vw, 40px);
      text-align: center;
      letter-spacing: 0.04em;
      white-space: nowrap;
    }
    .status {
      margin-top: 6px;
      font-size: 11px;
      text-align: center;
      opacity: .7;
    }
  </style>
</head>
<body>
  <div>
    <h1>英語スピードリーディング</h1>
    <div class="controls">
      <label>
        英文：
        <select id="textSelect">
          <option value="">選択してください</option>
          <option value="p1">Reading is a skill</option>
          <option value="p2">Technology and society</option>
          <option value="p3">Study and memory</option>
        </select>
      </label>
      <button id="playPauseBtn">▶︎</button>
      <label>
        速度
        <input type="range" id="speedSlider" min="150" max="800" step="10" value="350" />
        <span id="speedLabel">350 wpm</span>
      </label>
    </div>
    <div class="word-box">
      <div id="wordDisplay" class="word">英文を選んでください</div>
    </div>
    <div class="status" id="statusLabel">0 / 0　停止中</div>
  </div>

  <script>
    const passages = {
      p1: "Reading is a skill that you can improve through practice. When you read English every day, you gradually get used to common phrases and sentence patterns. This makes it easier to understand long passages in entrance exams. Try to focus on the meaning of each group of words rather than translating word by word.",
      p2: "Technology has changed the way we communicate with each other. In the past, people had to write letters and wait many days for a reply. Today, we can send messages instantly by email or social media. However, some researchers say that we may be losing deep conversations because we are always online.",
      p3: "Many students believe that they must study for long hours without a break. In fact, short and focused study sessions are often more effective. When you review important points regularly, the information moves from short term memory to long term memory. This method is useful when you prepare for university entrance exams."
    };

    const textSelect   = document.getElementById('textSelect');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const speedSlider  = document.getElementById('speedSlider');
    const speedLabel   = document.getElementById('speedLabel');
    const wordDisplay  = document.getElementById('wordDisplay');
    const statusLabel  = document.getElementById('statusLabel');

    let words = [];
    let index = 0;
    let running = false;
    let timerId = null;

    function setWordsFromPassage(id) {
      const text = passages[id] || "";
      words = text.split(/\s+/).filter(Boolean);
      index = 0;
      updateDisplay();
    }

    function wpmToIntervalMs(wpm) {
      return 60000 / Math.max(1, wpm);
    }

    function updateSpeedLabel() {
      const wpm = Number(speedSlider.value);
      speedLabel.textContent = wpm + " wpm";
      if (running) startTimer();
    }

    function updateDisplay() {
      if (!words.length) {
        wordDisplay.textContent = "英文を選んでください";
        statusLabel.textContent = "0 / 0　停止中";
        return;
      }
      const current = Math.min(index + 1, words.length);
      wordDisplay.textContent = words[index] || "";
      statusLabel.textContent = current + " / " + words.length + (running ? "　再生中" : "　停止中");
    }

    function advance() {
      if (!running || !words.length) return;
      index++;
      if (index >= words.length) {
        pause();
        index = words.length - 1;
      }
      updateDisplay();
    }

    function startTimer() {
      if (timerId) {
        clearTimeout(timerId);
        timerId = null;
      }
      if (!running || !words.length) return;
      const firstInterval = wpmToIntervalMs(Number(speedSlider.value));
      timerId = setTimeout(function tick() {
        if (!running || !words.length) return;
        advance();
        if (!running || !words.length) return;
        const nextInterval = wpmToIntervalMs(Number(speedSlider.value));
        timerId = setTimeout(tick, nextInterval);
      }, firstInterval);
    }

    function play() {
      if (!words.length) return;
      running = true;
      playPauseBtn.textContent = "⏸";
      if (index >= words.length) index = 0;
      updateDisplay();
      startTimer();
    }

    function pause() {
      running = false;
      playPauseBtn.textContent = "▶︎";
      if (timerId) {
        clearTimeout(timerId);
        timerId = null;
      }
      updateDisplay();
    }

    textSelect.addEventListener("change", () => {
      pause();
      setWordsFromPassage(textSelect.value);
    });

    playPauseBtn.addEventListener("click", () => {
      running ? pause() : play();
    });

    speedSlider.addEventListener("input", updateSpeedLabel);

    document.addEventListener("keydown", (e) => {
      if (e.target.tagName === "SELECT") return;
      if (e.code === "Space") {
        e.preventDefault();
        running ? pause() : play();
      } else if (e.key === "ArrowUp") {
        e.preventDefault();
        const v = Math.min(Number(speedSlider.max), Number(speedSlider.value) + 20);
        speedSlider.value = v;
        updateSpeedLabel();
      } else if (e.key === "ArrowDown") {
        e.preventDefault();
        const v = Math.max(Number(speedSlider.min), Number(speedSlider.value) - 20);
        speedSlider.value = v;
        updateSpeedLabel();
      }
    });

    updateSpeedLabel();
  </script>
</body>
</html>
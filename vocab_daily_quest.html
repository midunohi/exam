<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>英単語デイリークエスト</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: 'Spectral SC', 'Cinzel', serif;
      line-height: 1.5;
      color: #e6e0c8;
      background: #050509;
    }

    body {
      margin: 0;
      padding: 0;
      background:
        radial-gradient(circle at top left, rgba(120, 90, 180, 0.25), transparent 55%),
        radial-gradient(circle at bottom right, rgba(150, 60, 60, 0.25), transparent 60%),
        radial-gradient(circle at center, #151523 0%, #050509 65%, #000 100%);
      background-attachment: fixed;
    }

    #app {
      max-width: 720px;
      margin: 0 auto;
      padding: 1.5rem 1.25rem 3rem;
    }

    header {
      margin-bottom: 1.2rem;
      text-align: center;
    }

    header h1 {
      margin: 0 0 0.25rem;
      font-size: 1.8rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #f3e4b0;
      text-shadow:
        0 0 10px rgba(200, 180, 120, 0.7),
        0 0 24px rgba(120, 60, 40, 0.75);
    }

    header p {
      margin: 0;
      font-size: 0.9rem;
      color: #a89f8a;
    }

    .panel {
      background: rgba(18, 18, 30, 0.88);
      border-radius: 12px;
      border: 1px solid rgba(210, 180, 110, 0.45);
      box-shadow:
        0 0 20px rgba(0, 0, 0, 0.7),
        inset 0 0 14px rgba(250, 220, 160, 0.06);
      padding: 0.9rem 1rem;
      backdrop-filter: blur(4px);
    }

    .panel + .panel {
      margin-top: 0.9rem;
    }

    .panel-title {
      font-size: 0.9rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #e6ddc2;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .panel-title::before {
      content: "";
      width: 10px;
      height: 10px;
      border-radius: 50%;
      border: 1px solid rgba(230, 200, 130, 0.9);
      box-shadow: 0 0 6px rgba(230, 200, 130, 0.9);
    }

    /* HUD */
    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 0.5rem 0.75rem;
      font-size: 0.85rem;
    }

    .status-label {
      color: #c9c0a4;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .status-value {
      font-size: 0.95rem;
      color: #f5ebcf;
    }

    .exp-bar-wrap {
      margin-top: 0.5rem;
    }

    .exp-bar-track {
      height: 10px;
      border-radius: 999px;
      background: rgba(60, 50, 80, 0.7);
      overflow: hidden;
      border: 1px solid rgba(210, 180, 110, 0.6);
    }

    .exp-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #6f3c08, #c5a047);
      box-shadow: 0 0 10px rgba(200, 150, 90, 0.9);
      transition: width 0.25s ease-out;
    }

    /* 問題エリア */
    .question-area {
      margin-top: 0.25rem;
      padding: 0.75rem 0.8rem;
      border-radius: 10px;
      background:
        radial-gradient(circle at top left, rgba(70, 40, 100, 0.35), transparent 65%),
        radial-gradient(circle at bottom right, rgba(100, 50, 60, 0.35), transparent 70%),
        rgba(12, 12, 22, 0.95);
      border: 1px solid rgba(200, 170, 90, 0.45);
      box-shadow:
        0 0 12px rgba(0, 0, 0, 0.7),
        inset 0 0 10px rgba(250, 230, 180, 0.05);
      position: relative;
    }

    .question-area::before {
      content: "";
      position: absolute;
      inset: 6px;
      border-radius: 9px;
      border: 1px dashed rgba(200, 180, 110, 0.2);
      pointer-events: none;
    }

    .question-label {
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #b3a88f;
      margin-bottom: 0.25rem;
    }

    .question-text {
      font-size: 1.1rem;
      color: #f7e9c4;
      text-shadow: 0 0 6px rgba(240, 210, 150, 0.9);
      margin-bottom: 0.4rem;
    }

    .question-subtext {
      font-size: 0.85rem;
      color: #c0b494;
      margin-bottom: 0.4rem;
    }

    .choices {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.4rem;
      margin-top: 0.25rem;
    }

    .choice-btn {
      display: block;
      width: 100%;
      text-align: left;
      font-size: 0.85rem;
      border-radius: 999px;
      border: 1px solid rgba(190, 165, 110, 0.7);
      background: radial-gradient(circle at top, #272130 0%, #151118 55%, #0d0a11 100%);
      color: #f0e7cf;
      padding: 0.4rem 0.8rem;
      cursor: pointer;
      box-shadow: 0 0 8px rgba(40, 20, 10, 0.7);
    }

    .choice-btn:hover {
      filter: brightness(1.1);
      box-shadow:
        0 0 10px rgba(200, 150, 70, 0.9),
        0 0 16px rgba(220, 170, 90, 0.6);
    }

    .choice-btn.correct {
      border-color: #64d98a;
      box-shadow: 0 0 10px rgba(100, 220, 150, 0.9);
    }

    .choice-btn.wrong {
      border-color: #e06666;
      box-shadow: 0 0 10px rgba(210, 90, 90, 0.9);
    }

    .question-footer {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-top: 0.6rem;
      font-size: 0.8rem;
      color: #c3b79b;
    }

    .small-btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    .small-btn {
      font-size: 0.78rem;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(190, 165, 110, 0.7);
      background: radial-gradient(circle at top, #272130 0%, #151118 55%, #0d0a11 100%);
      color: #f0e7cf;
      cursor: pointer;
    }

    .small-btn:hover {
      filter: brightness(1.1);
    }

    .feedback {
      margin-top: 0.45rem;
      font-size: 0.85rem;
    }

    .feedback.good {
      color: #9ce6a8;
    }

    .feedback.bad {
      color: #f29a9a;
    }

    .hint-area {
      font-size: 0.8rem;
      color: #d3c8ab;
      margin-top: 0.4rem;
    }

    .hint-empty {
      font-style: italic;
      color: #8f8673;
    }

    .summary-row {
      margin-top: 0.4rem;
      font-size: 0.8rem;
      color: #d8cfb3;
    }

    .summary-row strong {
      color: #f3e4b0;
    }

    .reset-btn {
      margin-top: 0.6rem;
      font-size: 0.75rem;
      color: #f0d6b0;
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: 3px;
    }

    .reset-btn:hover {
      color: #ffe0b8;
    }
  </style>
</head>
<body>
  <div id="app">
    <header>
      <h1>英単語デイリークエスト</h1>
    </header>

    <!-- ステータス -->
    <section class="panel">
      <div class="panel-title">Status</div>
      <div class="status-grid">
        <div>
          <div class="status-label">Level</div>
          <div class="status-value" id="hud-level">1</div>
        </div>
        <div>
          <div class="status-label">EXP</div>
          <div class="status-value" id="hud-exp-text">0 / 50</div>
        </div>
        <div>
          <div class="status-label">Today</div>
          <div class="status-value"><span id="hud-answered-today">0</span> / <span id="hud-daily-target">10</span> 問</div>
        </div>
        <div>
          <div class="status-label">Correct</div>
          <div class="status-value" id="hud-accuracy">-</div>
        </div>
      </div>
      <div class="exp-bar-wrap">
        <div class="exp-bar-track"><div class="exp-bar-fill" id="exp-bar"></div></div>
      </div>
      <div class="summary-row" id="daily-status-text">今日のクエスト：未達成</div>
      <button class="reset-btn" id="btn-reset">データを初期化</button>
    </section>

    <!-- 問題 -->
    <section class="panel">
      <div class="panel-title">今日のモンスター（単語）</div>
      <div class="question-area">
        <div class="question-label">Current word</div>
        <div class="question-text" id="question-word">-</div>
        <div class="question-subtext" id="question-subtext">日本語の意味を選んでください。</div>

        <div class="choices" id="choice-container"></div>

        <div class="question-footer">
          <div>解いた問題数：<span id="hud-total-count">0</span></div>
          <div class="small-btn-row">
            <button class="small-btn" id="btn-hint">ヒント（例文）</button>
            <button class="small-btn" id="btn-reveal">答えを見る</button>
            <button class="small-btn" id="btn-next">次の単語</button>
          </div>
        </div>

        <div class="feedback" id="feedback"></div>
        <div class="hint-area" id="hint-area">
          <p class="hint-empty">ヒントボタンを押すと、例文がここに表示されます。</p>
        </div>
      </div>
    </section>
  </div>

  <script>
    // =====================================
    // 単語データ（サンプル）
    // =====================================
    const WORD_POOL = [
      {
        headword: "existence",
        meaning_ja: "存在",
        examples: [
          { en: "The existence of water is essential for life.", ja: "水の存在は生命にとって不可欠だ。" }
        ]
      },
      {
        headword: "entity",
        meaning_ja: "実体、存在",
        examples: [
          { en: "Each company is a separate legal entity.", ja: "それぞれの会社は別個の法的実体である。" }
        ]
      },
      {
        headword: "essence",
        meaning_ja: "本質、真髄",
        examples: [
          { en: "The essence of the story is about hope.", ja: "その物語の本質は希望についてだ。" }
        ]
      },
      {
        headword: "realm",
        meaning_ja: "領域、王国",
        examples: [
          { en: "This idea belongs to the realm of fantasy.", ja: "この考えはファンタジーの領域に属する。" }
        ]
      },
      {
        headword: "ritual",
        meaning_ja: "儀式、習慣的行為",
        examples: [
          { en: "The villagers performed an ancient ritual.", ja: "村人たちは古い儀式を行った。" }
        ]
      },
      {
        headword: "omen",
        meaning_ja: "前兆、兆し",
        examples: [
          { en: "A black cat is sometimes seen as a bad omen.", ja: "黒猫は時に悪い前兆と見なされる。" }
        ]
      },
      {
        headword: "mystic",
        meaning_ja: "神秘的な、神秘家",
        examples: [
          { en: "The forest had a mystic atmosphere.", ja: "森には神秘的な雰囲気が漂っていた。" }
        ]
      },
      {
        headword: "ancient",
        meaning_ja: "古代の、古くからの",
        examples: [
          { en: "They studied ancient texts in the library.", ja: "彼らは図書館で古代の文献を研究した。" }
        ]
      },
      {
        headword: "blessing",
        meaning_ja: "祝福、恩恵",
        examples: [
          { en: "The rain was a blessing for the dry fields.", ja: "雨は乾いた畑にとって恵みだった。" }
        ]
      },
      {
        headword: "curse",
        meaning_ja: "呪い",
        examples: [
          { en: "The castle was said to be under a curse.", ja: "その城は呪われていると言われていた。" }
        ]
      }
    ];

    // =====================================
    // セーブデータ
    // =====================================
    const SAVE_KEY = "vocab_daily_simple_v1";

    const defaultState = () => ({
      level: 1,
      exp: 0,
      expToNext: 50,
      correctCount: 0,
      totalCount: 0,
      answeredToday: 0,
      dailyTarget: 10
    });

    let state = loadState();

    function loadState() {
      try {
        const raw = localStorage.getItem(SAVE_KEY);
        if (!raw) return defaultState();
        const parsed = JSON.parse(raw);
        return { ...defaultState(), ...parsed };
      } catch (_) {
        return defaultState();
      }
    }

    function saveState() {
      try {
        localStorage.setItem(SAVE_KEY, JSON.stringify(state));
      } catch (_) {}
    }

    function resetState() {
      state = defaultState();
      saveState();
      updateHud();
      setFeedback("データを初期化しました。", "");
      pickNextWord();
    }

    // =====================================
    // DOM 参照
    // =====================================
    const hudLevelEl = document.getElementById("hud-level");
    const hudExpTextEl = document.getElementById("hud-exp-text");
    const hudAnsweredTodayEl = document.getElementById("hud-answered-today");
    const hudDailyTargetEl = document.getElementById("hud-daily-target");
    const hudAccuracyEl = document.getElementById("hud-accuracy");
    const hudTotalCountEl = document.getElementById("hud-total-count");
    const expBarEl = document.getElementById("exp-bar");
    const dailyStatusTextEl = document.getElementById("daily-status-text");

    const questionWordEl = document.getElementById("question-word");
    const questionSubtextEl = document.getElementById("question-subtext");
    const choiceContainerEl = document.getElementById("choice-container");
    const feedbackEl = document.getElementById("feedback");
    const hintAreaEl = document.getElementById("hint-area");

    const btnHint = document.getElementById("btn-hint");
    const btnReveal = document.getElementById("btn-reveal");
    const btnNext = document.getElementById("btn-next");
    const btnReset = document.getElementById("btn-reset");

    // =====================================
    // HUD 更新
    // =====================================
    function updateHud() {
      hudLevelEl.textContent = state.level;
      hudExpTextEl.textContent = `${state.exp} / ${state.expToNext}`;

      const expRatio = Math.max(0, Math.min(1, state.exp / state.expToNext));
      expBarEl.style.width = `${expRatio * 100}%`;

      hudAnsweredTodayEl.textContent = state.answeredToday;
      hudDailyTargetEl.textContent = state.dailyTarget;

      hudTotalCountEl.textContent = state.totalCount;

      const acc = state.totalCount > 0 ? (state.correctCount / state.totalCount) * 100 : 0;
      hudAccuracyEl.textContent = state.totalCount === 0 ? "-" : `${acc.toFixed(1)}%`;

      if (state.answeredToday >= state.dailyTarget) {
        dailyStatusTextEl.textContent = "今日のクエスト：達成！";
      } else {
        dailyStatusTextEl.textContent = `今日のクエスト：あと ${Math.max(0, state.dailyTarget - state.answeredToday)} 問`;
      }
    }

    // =====================================
    // 問題生成
    // =====================================
    let currentWord = null;
    let currentChoices = [];
    let questionAnswered = false;

    function pickRandomWord() {
      return WORD_POOL[Math.floor(Math.random() * WORD_POOL.length)];
    }

    function shuffle(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function makeChoices(correctWord) {
      const pool = WORD_POOL.filter(w => w !== correctWord);
      const wrong = shuffle(pool).slice(0, 3);
      const candidates = [...wrong, correctWord];
      return shuffle(candidates);
    }

    function renderQuestion() {
      if (!currentWord) return;
      questionWordEl.textContent = currentWord.headword;
      questionSubtextEl.textContent = "日本語の意味を選んでください。";

      choiceContainerEl.innerHTML = "";
      currentChoices.forEach(word => {
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        btn.textContent = word.meaning_ja;
        btn.addEventListener("click", () => handleAnswer(word));
        choiceContainerEl.appendChild(btn);
      });

      // ヒント初期化
      hintAreaEl.innerHTML = '<p class="hint-empty">ヒントボタンを押すと、例文がここに表示されます。</p>';
      setFeedback("", "");
      questionAnswered = false;
    }

    function pickNextWord() {
      currentWord = pickRandomWord();
      currentChoices = makeChoices(currentWord);
      renderQuestion();
    }

    // =====================================
    // 回答処理
    // =====================================
    function setFeedback(text, type) {
      feedbackEl.textContent = text;
      feedbackEl.className = "feedback" + (type ? ` ${type}` : "");
    }

    function handleAnswer(selectedWord) {
      if (questionAnswered) return;
      if (!currentWord) return;

      questionAnswered = true;

      const isCorrect = selectedWord === currentWord;
      const choiceButtons = choiceContainerEl.querySelectorAll(".choice-btn");

      choiceButtons.forEach(btn => {
        const text = btn.textContent;
        if (text === currentWord.meaning_ja) {
          btn.classList.add("correct");
        }
        if (text === selectedWord.meaning_ja && !isCorrect) {
          btn.classList.add("wrong");
        }
      });

      // ステータス更新
      state.totalCount += 1;
      state.answeredToday += 1;

      if (isCorrect) {
        state.correctCount += 1;
        const gainExp = 10;
        state.exp += gainExp;
        setFeedback(`正解！ ${currentWord.headword} = ${currentWord.meaning_ja}  (+${gainExp} EXP)`, "good");
      } else {
        const gainExp = 3;
        state.exp += gainExp;
        setFeedback(`不正解... 正しくは「${currentWord.headword} = ${currentWord.meaning_ja}」 (+${gainExp} EXP)`, "bad");
      }

      handleLevelUpIfNeeded();
      updateHud();
      saveState();
    }

    function handleLevelUpIfNeeded() {
      let leveled = false;
      while (state.exp >= state.expToNext) {
        state.exp -= state.expToNext;
        state.level += 1;
        state.expToNext = Math.floor(state.expToNext * 1.2 + 10);
        leveled = true;
      }
      if (leveled) {
        const current = feedbackEl.textContent;
        const extra = current ? " " : "";
        setFeedback((current || "") + `${extra}レベルアップ！ Lv.${state.level} に到達しました。`, "good");
      }
    }

    // =====================================
    // ボタンイベント
    // =====================================
    btnHint.addEventListener("click", () => {
      if (!currentWord) return;
      const ex = currentWord.examples && currentWord.examples[0];
      if (!ex) {
        hintAreaEl.innerHTML = '<p class="hint-empty">この単語には例文が登録されていません。</p>';
        return;
      }
      hintAreaEl.innerHTML = `
        <p style="margin:0 0 0.2rem;">例文:</p>
        <p style="margin:0 0 0.1rem;">${ex.en}</p>
        <p style="margin:0;color:#b8af98;">${ex.ja}</p>
      `;
    });

    btnReveal.addEventListener("click", () => {
      if (!currentWord) return;
      hintAreaEl.innerHTML = `<p>答え: <strong>${currentWord.headword} = ${currentWord.meaning_ja}</strong></p>`;
    });

    btnNext.addEventListener("click", () => {
      pickNextWord();
    });

    btnReset.addEventListener("click", () => {
      if (confirm("データを初期化しますか？")) {
        resetState();
      }
    });

    // =====================================
    // 初期化
    // =====================================
    function init() {
      updateHud();
      pickNextWord();
      setFeedback("英単語デイリークエストへようこそ。", "");
    }

    init();
  </script>
</body>
</html>

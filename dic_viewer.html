<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>英単語帳ビューア</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
   :root {
  font-family: 'Spectral SC', 'Cinzel', serif;
  line-height: 1.5;
  color: #e6e0c8;
  background: #050509;
}

body {
  margin: 0;
  padding: 0;
  background:
    radial-gradient(circle at top left, rgba(120, 90, 180, 0.25), transparent 55%),
    radial-gradient(circle at bottom right, rgba(150, 60, 60, 0.25), transparent 60%),
    radial-gradient(circle at center, #151523 0%, #050509 65%, #000 100%);
  background-attachment: fixed;
}

/* コンテナ */
#app {
  max-width: 960px;
  margin: 0 auto;
  padding: 1.5rem 1.25rem 3rem;
}

/* ヘッダー */
header {
  margin-bottom: 1.5rem;
}

header h1 {
  margin: 0 0 0.25rem;
  font-size: 1.8rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: #f3e4b0;
  text-shadow:
    0 0 10px rgba(200, 180, 120, 0.7),
    0 0 24px rgba(120, 60, 40, 0.75);
}

header p {
  margin: 0;
  font-size: 0.9rem;
  color: #a89f8a;
}

/* パネル共通 */
.panel {
  background: rgba(18, 18, 30, 0.88);
  border-radius: 12px;
  border: 1px solid rgba(210, 180, 110, 0.45);
  box-shadow:
    0 0 20px rgba(0, 0, 0, 0.7),
    inset 0 0 14px rgba(250, 220, 160, 0.06);
  padding: 1rem 1.25rem;
  margin-bottom: 1rem;
  backdrop-filter: blur(4px);
}

/* コントロール部分 */
#controls {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.9rem;
}

#controls label {
  font-weight: 600;
  color: #e6ddc2;
}

/* セレクト・ボタン */
select,
button {
  font: inherit;
  border-radius: 999px;
  padding: 0.35rem 0.85rem;
  border: 1px solid rgba(190, 165, 110, 0.7);
  background: radial-gradient(circle at top, #272130 0%, #151118 55%, #0d0a11 100%);
  color: #f0e7cf;
  box-shadow: 0 0 10px rgba(40, 20, 10, 0.7);
}

select:focus {
  outline: none;
  box-shadow:
    0 0 0 1px rgba(230, 200, 130, 0.8),
    0 0 12px rgba(220, 190, 120, 0.7);
}

button {
  cursor: pointer;
  background: linear-gradient(135deg, #6f3c08, #c5a047);
  border: 1px solid #c5aa60;
  box-shadow:
    0 0 9px rgba(150, 100, 30, 0.7),
    0 0 18px rgba(180, 120, 40, 0.45);
  font-weight: 600;
}

button:hover {
  filter: brightness(1.12);
  box-shadow:
    0 0 12px rgba(200, 150, 70, 0.9),
    0 0 22px rgba(220, 170, 90, 0.75);
}

button:disabled {
  opacity: 0.55;
  cursor: default;
  filter: grayscale(0.3);
  box-shadow: none;
}

/* ステータス表示 */
#status {
  font-size: 0.75rem;
  color: #9a9280;
}

#status span.tag {
  display: inline-block;
  padding: 0.1rem 0.5rem;
  border-radius: 999px;
  font-size: 0.7rem;
  margin-left: 0.25rem;
  background: rgba(80, 60, 130, 0.6);
  color: #efe4ff;
  border: 1px solid rgba(190, 170, 240, 0.7);
}

/* 単語リスト */
#wordList {
  margin-top: 0.75rem;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 0.75rem;
}

/* 単語カード */
.word-card {
  background: radial-gradient(circle at top left, rgba(70, 40, 100, 0.3), transparent 65%),
              radial-gradient(circle at bottom right, rgba(100, 50, 60, 0.35), transparent 70%),
              rgba(12, 12, 22, 0.98);
  border-radius: 10px;
  padding: 0.75rem 0.9rem;
  border: 1px solid rgba(200, 170, 90, 0.35);
  box-shadow:
    0 0 12px rgba(0, 0, 0, 0.7),
    inset 0 0 10px rgba(250, 230, 180, 0.05);
  color: #f0ead7;
  position: relative;
}

/* カードの淡い模様（魔法陣の残光っぽい） */
.word-card::before {
  content: "";
  position: absolute;
  inset: 6px;
  border-radius: 9px;
  border: 1px dashed rgba(200, 180, 110, 0.15);
  pointer-events: none;
}

/* 見出し部 */
.word-header {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 0.5rem;
}

.word-headword {
  font-weight: 700;
  font-size: 1rem;
  letter-spacing: 0.03em;
  color: #f7e9c4;
  text-shadow: 0 0 6px rgba(240, 210, 150, 0.9);
}

.word-pos {
  font-size: 0.75rem;
  color: #c1b79a;
  font-style: italic;
}

/* 日本語意味 */
.word-meaning {
  margin-top: 0.2rem;
  font-size: 0.85rem;
  color: #e8ddc0;
}

/* セクションラベル */
.section-label {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.09em;
  color: #a89c80;
  margin-top: 0.35rem;
}

/* 例文・フレーズ */
.examples,
.phrases {
  margin: 0.2rem 0 0;
  padding-left: 1.1rem;
  font-size: 0.8rem;
  color: #e0d7bd;
}

.examples li + li,
.phrases li + li {
  margin-top: 0.15rem;
}

.examples li span:last-child {
  color: #b8af98;
}

/* 備考 */
.notes {
  margin-top: 0.25rem;
  font-size: 0.75rem;
  color: #afa58a;
  border-top: 1px dashed rgba(210, 190, 140, 0.45);
  padding-top: 0.25rem;
}

/* バッジ（カテゴリ表示） */
.badge {
  display: inline-block;
  font-size: 0.68rem;
  padding: 0.1rem 0.4rem;
  border-radius: 999px;
  background: radial-gradient(circle at top, rgba(150, 110, 40, 0.9), rgba(90, 50, 20, 0.9));
  color: #f7ebc7;
  border: 1px solid rgba(230, 200, 120, 0.9);
  text-shadow: 0 0 4px rgba(80, 40, 20, 0.9);
}

/* レスポンシブ */
@media (max-width: 640px) {
  #app {
    padding: 1rem 0.75rem 2.5rem;
  }

  #wordList {
    grid-template-columns: minmax(0, 1fr);
  }
}
  </style>
</head>
<body>
  <div id="app">
    <header>
      <h1>英単語帳ビューア</h1>
      <p>通常環境では <code>di/&lt;カテゴリ名&gt;.json</code> を fetch し、Canvas 環境ではダミーデータを利用します。</p>
    </header>

    <section class="panel" id="controls">
      <label for="categorySelect">カテゴリ:</label>
      <select id="categorySelect">
        <option value="existence">existence（存在・実体）</option>
        <!-- 将来 quantity などを追加可能 -->
      </select>
      <button id="reloadBtn">読み込み</button>
      <div id="status"></div>
    </section>

    <section class="panel">
      <div id="categoryMeta" style="font-size:0.85rem;color:#555;margin-bottom:0.5rem;"></div>
      <div id="wordList"></div>
    </section>
  </div>

  <script>
    // ---- ダミーデータ（ChatGPT Canvas / ファイルが無い環境用） ----
    const dummyDataByCategory = {
      existence: {
        categories: [
          {
            id: "existence",
            name_ja: "存在・実体",
            name_en: "Existence / Entity",
            words: [
              {
                headword: "existence",
                pos: "noun",
                meaning_ja: "存在",
                examples: [
                  { en: "The existence of water is essential for life.", ja: "水の存在は生命にとって不可欠だ。" }
                ],
                phrases: ["come into existence"],
                notes: "abstract noun, often used with 'of'"
              },
              {
                headword: "entity",
                pos: "noun",
                meaning_ja: "実体、存在",
                examples: [
                  { en: "Each company is a separate legal entity.", ja: "それぞれの会社は別個の法的実体である。" }
                ],
                phrases: ["independent entity"],
                notes: "often used in legal or philosophical context"
              },
            ]
          }
        ]
      }
    };

    const categorySelect = document.getElementById("categorySelect");
    const reloadBtn = document.getElementById("reloadBtn");
    const statusEl = document.getElementById("status");
    const wordListEl = document.getElementById("wordList");
    const categoryMetaEl = document.getElementById("categoryMeta");

    function setStatus(text, tag) {
      statusEl.innerHTML = "";
      if (!text && !tag) return;
      const spanText = document.createElement("span");
      spanText.textContent = text;
      statusEl.appendChild(spanText);
      if (tag) {
        const spanTag = document.createElement("span");
        spanTag.className = "tag";
        spanTag.textContent = tag;
        statusEl.appendChild(spanTag);
      }
    }

    function clearWordList() {
      while (wordListEl.firstChild) wordListEl.removeChild(wordListEl.firstChild);
    }

    function renderCategory(data, categoryId) {
      clearWordList();

      let category = null;
      if (data && Array.isArray(data.categories)) {
        category = data.categories.find(c => c.id === categoryId) || data.categories[0];
      } else if (data && data.words) {
        category = data;
      }

      if (!category) {
        categoryMetaEl.textContent = "カテゴリデータが見つかりません。";
        return;
      }

      const { name_ja, name_en, words } = category;
      categoryMetaEl.innerHTML = `
        <span class="badge">${categoryId}</span>
        <strong style="margin-left:0.4rem;">${name_ja || ""}</strong>
        <span style="margin-left:0.3rem;color:#777;">${name_en || ""}</span>
        <span style="margin-left:0.6rem;font-size:0.75rem;color:#777;">単語数: ${words ? words.length : 0}</span>
      `;

      if (!Array.isArray(words) || words.length === 0) {
        const p = document.createElement("p");
        p.textContent = "このカテゴリには単語が登録されていません。";
        p.style.fontSize = "0.9rem";
        wordListEl.appendChild(p);
        return;
      }

      for (const w of words) {
        const card = document.createElement("article");
        card.className = "word-card";

        const header = document.createElement("div");
        header.className = "word-header";

        const headwordEl = document.createElement("div");
        headwordEl.className = "word-headword";
        headwordEl.textContent = w.headword;

        const posEl = document.createElement("div");
        posEl.className = "word-pos";
        posEl.textContent = w.pos || "";

        header.appendChild(headwordEl);
        header.appendChild(posEl);

        const meaningEl = document.createElement("div");
        meaningEl.className = "word-meaning";
        meaningEl.textContent = w.meaning_ja || "";

        card.appendChild(header);
        card.appendChild(meaningEl);

        if (Array.isArray(w.examples) && w.examples.length > 0) {
          const label = document.createElement("div");
          label.className = "section-label";
          label.textContent = "Examples";
          card.appendChild(label);

          const ul = document.createElement("ul");
          ul.className = "examples";
          for (const ex of w.examples) {
            const li = document.createElement("li");
            const enSpan = document.createElement("span");
            enSpan.textContent = ex.en;
            const br = document.createElement("br");
            const jaSpan = document.createElement("span");
            jaSpan.style.color = "#666";
            jaSpan.textContent = ex.ja;
            li.appendChild(enSpan);
            li.appendChild(br);
            li.appendChild(jaSpan);
            ul.appendChild(li);
          }
          card.appendChild(ul);
        }

        if (Array.isArray(w.phrases) && w.phrases.length > 0) {
          const label = document.createElement("div");
          label.className = "section-label";
          label.textContent = "Phrases";
          card.appendChild(label);

          const ul = document.createElement("ul");
          ul.className = "phrases";
          for (const ph of w.phrases) {
            const li = document.createElement("li");
            li.textContent = ph;
            ul.appendChild(li);
          }
          card.appendChild(ul);
        }

        if (w.notes) {
          const notesEl = document.createElement("div");
          notesEl.className = "notes";
          notesEl.textContent = w.notes;
          card.appendChild(notesEl);
        }

        wordListEl.appendChild(card);
      }
    }

    function getCategoryUrl(categoryId) {
      return `dic/${categoryId}.json`;
    }

    async function loadCategoryList() {
      const sel = document.getElementById("categorySelect");
      sel.innerHTML = ""; // 初期化

      try {
        const res = await fetch("dic/categories.json", { cache: "no-store" });
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }
        const data = await res.json();

        for (const name of data.files) {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          sel.appendChild(opt);
        }

        setStatus("dic/categories.json からカテゴリ一覧を読み込みました。", "fetch");
      } catch (err) {
        // 失敗したらダミーデータ側のキーからカテゴリ一覧を作る（Canvas / ローカル用）
        const fileList = Object.keys(dummyDataByCategory);
        for (const name of fileList) {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          sel.appendChild(opt);
        }
        setStatus("カテゴリ一覧の読み込みに失敗したため、ダミー一覧を使用しています。", "dummy");
      }
    }

    async function loadCategory(categoryId) {
      clearWordList();
      setStatus("読み込み中...", null);
      reloadBtn.disabled = true;

      const url = getCategoryUrl(categoryId);
      let loadedFrom = "remote";

      try {
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }
        const data = await res.json();
        renderCategory(data, categoryId);
        setStatus(`${url} から読み込みました。`, "fetch");
      } catch (err) {
        // Canvas やローカルで di/*.json が無い場合などはダミーにフォールバック
        const dummy = dummyDataByCategory[categoryId];
        if (dummy) {
          renderCategory(dummy, categoryId);
          setStatus("ダミーデータを使用しています（Canvas / ローカルテスト用）", "dummy");
        } else {
          setStatus(`データの読み込みに失敗しました: ${String(err)}`, "error");
        }
      } finally {
        reloadBtn.disabled = false;
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadCategoryList()
        .then(() => {
          // 成功・失敗どちらでも、とにかく現在の select の値で読み込む
          loadCategory(categorySelect.value);
        })
        .catch(err => {
          // 念のための保険（ここには基本来ない想定）
          console.error(err);
          loadCategory(categorySelect.value);
        });

      reloadBtn.addEventListener("click", () => {
        loadCategory(categorySelect.value);
      });
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>è‹±å˜èªRPGãƒãƒˆãƒ«ï¼ˆæ¥µç°¡æ˜“ç‰ˆï¼‰</title>
<style>
  :root{--bg:#020617;--ok:#22c55e;--bad:#ef4444}
  *{box-sizing:border-box}
  html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif;
  /* ã‚·ãƒ³ãƒ—ãƒ«ãªåœ°å¹³ç·šèƒŒæ™¯ï¼ˆç©ºï¼‹åœ°é¢ï¼‰ */
  background:
    linear-gradient(to bottom,
      #0b1a33 0%,
      #1e3a8a 45%,  /* ç©º */
      #1f2937 46%,  /* åœ°å¹³ç·š */
      #020617 100%  /* åœ°é¢ */
    );
  color:#ffffff;
}

  #wrap{min-height:100vh;display:flex;flex-direction:column;gap:8px;padding:8px}
  #topGrid{display:grid;grid-template-columns:minmax(0,1.2fr) minmax(0,1fr);gap:8px}
  .panel{background:none;border-radius:0;padding:0}
  .compact{font-size:14px;line-height:1.3}
  .row{display:flex;align-items:center;gap:6px;margin-bottom:4px}
  .row span.label{opacity:.8}
  .bar{flex:1;height:12px;border-radius:999px;overflow:hidden;background:#020617}
  .bar>span{display:block;height:100%;width:0;transition:width .25s}
  .hp>span{background:linear-gradient(90deg,#ef4444,#b91c1c)}
  .exp>span{background:linear-gradient(90deg,#38bdf8,#0ea5e9)}
  .val{min-width:90px;text-align:right;opacity:.9;font-size:12px}

  #question{margin:0 0 6px;font-size:16px}
  #choices{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:6px}
  button.choice{padding:8px;border-radius:8px;border:0;background:#111827;color:inherit;font-size:14px;cursor:pointer}
  button.choice:disabled{opacity:.6;cursor:default}

  #logWrap{flex:1;min-height:110px;display:flex;flex-direction:column;padding-top:2px}
  #log{flex:1;overflow:auto;font-size:13px;padding:4px 2px}
  #log p{margin:2px 0}
  .ok{color:var(--ok)}
  .bad{color:var(--bad)}
  .blink{animation:blink .24s 3}
  @keyframes blink{50%{filter:brightness(2)}}

  #buttons{margin-top:4px;text-align:right}
  #buttons button{margin-left:4px;padding:4px 10px;font-size:12px;border-radius:6px;border:0;cursor:pointer;background:#111827;color:inherit}

  #enemyView svg{display:block;width:100%;height:auto}
</style>
</head>
<body>
<div id="wrap">
  <div id="topGrid">
    <!-- å·¦ä¸Š: è‡ªã‚­ãƒ£ãƒ©ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
    <section id="heroBox" class="panel compact">
      <div class="row"><span class="label">Lv</span><span id="lv">1</span></div>
      <div class="row"><span class="label">EXP</span><div class="bar exp"><span id="expBar"></span></div><span class="val" id="expText">0 / 20</span></div>
      <div class="row"><span class="label">HP</span><div class="bar hp"><span id="hpBar"></span></div><span class="val" id="hpText">30 / 30</span></div>
      <div class="row"><span class="label">ATK</span><span id="atk">5</span></div>
    </section>

    <!-- å³ä¸Š: æ•µã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
    <section id="enemyBox" class="panel compact">
      <div class="row"><span class="label">ENEMY</span><span id="enemyName">?</span></div>
      <div class="row"><span class="label">HP</span><div class="bar hp"><span id="enemyHpBar"></span></div><span class="val" id="enemyHpText">0 / 0</span></div>
    </section>

    <!-- å·¦2æ®µç›®: 4æŠå•é¡Œ -->
    <section id="qaBox" class="panel">
      <p id="question">â€”</p>
      <div id="choices"></div>
    </section>

    <!-- å³2æ®µç›®: æ•µã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ï¼ˆç°¡å˜ãªSVGï¼‰ -->
    <section id="enemyView" class="panel">
      <svg viewBox="0 0 120 90">
        <defs>
          <radialGradient id="slimeGrad" cx="35%" cy="30%" r="60%">
            <stop offset="0%" stop-color="#bbf7d0"/>
            <stop offset="100%" stop-color="#22c55e"/>
          </radialGradient>
        </defs>
        <!-- å½± -->
        <ellipse cx="60" cy="70" rx="32" ry="8" fill="#000" opacity=".35"/>
        <!-- çƒä½“ã‚¹ãƒ©ã‚¤ãƒ ï¼ˆå®Œå…¨ãªå††å½¢ï¼‰ -->
        <circle cx="60" cy="40" r="28" fill="url(#slimeGrad)" stroke="#16a34a" stroke-width="3"/>
        <!-- ç›® -->
        <circle cx="50" cy="38" r="5" fill="#022c22"/>
        <circle cx="70" cy="38" r="5" fill="#022c22"/>
        <circle cx="51" cy="37" r="2" fill="#e5e7eb"/>
        <circle cx="71" cy="37" r="2" fill="#e5e7eb"/>
        <!-- å£ -->
        <path d="M50,50 Q60,54 70,50" fill="none" stroke="#052e16" stroke-width="3" stroke-linecap="round"/>
      </svg>
    </section>
  </div>

  <!-- ä¸‹: ã‚²ãƒ¼ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
  <section id="logWrap" class="panel">
    <div id="log"></div>
    <div id="buttons">
      <button id="nextBtn" style="display:none">æ¬¡ã®æ•µ â–¶</button>
      <button id="retryBtn" style="display:none">ãƒªãƒˆãƒ©ã‚¤ âŸ³</button>
    </div>
  </section>
</div>

<script>
const KEY = 'midunohi.exam.exp';
const rand = n => Math.floor(Math.random()*n);
const clamp = (x,a,b) => Math.max(a,Math.min(b,x));
const setBar = (id,r) => { const el=document.getElementById(id); if(el) el.style.width=(100*clamp(r,0,1)).toFixed(1)+'%'; };
const log = html => { const el=document.getElementById('log'); if(!el) return; el.insertAdjacentHTML('beforeend',`<p>${html}</p>`); el.scrollTop=el.scrollHeight; };

const WORDS=[
  {jp:'å¿è€',ans:'perseverance',opts:['bravery','tenacity','perseverance','humility']},
  {jp:'è¦‹ã›ã‹ã‘',ans:'pretense',opts:['presence','pretense','premise','protÃ©gÃ©']},
  {jp:'å½“æƒ‘',ans:'consternation',opts:['contemplation','constellation','consternation','conflagration']},
  {jp:'ä¸å‰ãª',ans:'ominous',opts:['ominous','amiable','anxious','arduous']},
  {jp:'å®Ÿç”¨çš„ãª',ans:'pragmatic',opts:['dogmatic','pragmatic','problematic','charismatic']},
  {jp:'ç„¡æ„å‘³ã•',ans:'futility',opts:['fertility','frivolity','futility','fluidity']},
  {jp:'å¹³é™',ans:'equanimity',opts:['equity','equanimity','equivalence','equation']},
  {jp:'ç”˜ç¾ãª',ans:'luscious',opts:['lucid','ludicrous','luscious','lush']},
  {jp:'å³æ ¼ãª',ans:'stringent',opts:['strident','stringent','stringy','striking']},
  {jp:'æ‡ç–‘çš„ãª',ans:'skeptical',opts:['spectral','skeptical','skeletal','spherical']}
];

const ENEMIES=[
  {name:'ã‚¹ãƒ©ã‚¤ãƒ ', hp:28, atk:[3,6], xp:10},
  {name:'ã‚¦ãƒ«ãƒ•', hp:40, atk:[5,9], xp:15},
  {name:'ã‚ªãƒ¼ã‚¬', hp:65, atk:[8,14], xp:20}
];

const state={
  lv:1, exp:0, nextExp:20,
  hp:30, maxHP:30, baseATK:5,
  enemyIndex:0, enemy:null,
  pool:[...WORDS], used:new Set(),
  totalExp:0
};

function resetStats(){
  state.lv=1; state.exp=0; state.nextExp=20;
  state.baseATK=5; state.maxHP=30; state.hp=state.maxHP;
}
function silentLevelUp(){
  state.lv++;
  const hpGain=8+Math.floor(state.lv*1.5);
  state.maxHP+=hpGain; state.hp=state.maxHP;
  state.baseATK+=2;
  state.nextExp=Math.round(state.nextExp*1.35);
}
function levelUp(){
  silentLevelUp();
  log(`<span class="ok">âœ¨ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ Lv${state.lv}</span>`);
}

function loadExp(){
  const v = Number(localStorage.getItem(KEY) || '0');
  if(!Number.isFinite(v) || v<=0) return;
  state.totalExp=v;
  resetStats();
  let rest=v;
  while(rest>=state.nextExp){ rest-=state.nextExp; silentLevelUp(); }
  state.exp=rest;
}
function addExp(x){
  if(x<=0) return;
  state.totalExp+=x;
  try{ localStorage.setItem(KEY,String(state.totalExp)); }catch(e){}
  state.exp+=x;
  while(state.exp>=state.nextExp){ state.exp-=state.nextExp; levelUp(); }
  renderHUD();
}

function spawnEnemy(){
  const base=ENEMIES[state.enemyIndex % ENEMIES.length];
  state.enemy={
    name:base.name,
    maxHP:base.hp,
    hp:base.hp,
    atkMin:base.atk[0],
    atkMax:base.atk[1],
    xp:base.xp
  };
  document.getElementById('enemyName').textContent=state.enemy.name;
  updateEnemyHUD();
  log(`<span>ğŸ‘¾ ${state.enemy.name} ãŒç¾ã‚ŒãŸï¼ï¼ˆHP ${state.enemy.hp}ï¼‰</span>`);
}

function renderHUD(){
  document.getElementById('lv').textContent=state.lv;
  document.getElementById('atk').textContent=state.baseATK;
  document.getElementById('hpText').textContent=`${state.hp} / ${state.maxHP}`;
  document.getElementById('expText').textContent=`${state.exp} / ${state.nextExp}`;
  setBar('hpBar', state.hp/state.maxHP);
  setBar('expBar', state.exp/state.nextExp);
}
function updateEnemyHUD(){
  document.getElementById('enemyHpText').textContent=`${state.enemy.hp} / ${state.enemy.maxHP}`;
  setBar('enemyHpBar', state.enemy.hp/state.enemy.maxHP);
}

let currentQ=null;
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=rand(i+1); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function nextQuestion(){
  const poolIdx=state.pool.map((_,i)=>i).filter(i=>!state.used.has(i));
  if(!poolIdx.length){ state.used.clear(); return nextQuestion(); }
  const pick=poolIdx[rand(poolIdx.length)];
  state.used.add(pick);
  const q=state.pool[pick];
  const opts=[...new Set(q.opts)];
  if(!opts.includes(q.ans)) opts[rand(opts.length)]=q.ans;
  currentQ={jp:q.jp,ans:q.ans,choices:shuffle(opts)};
  document.getElementById('question').textContent=`ã€Œ${currentQ.jp}ã€ã®è‹±èªã¯ï¼Ÿ`;
  const box=document.getElementById('choices');
  box.innerHTML='';
  currentQ.choices.forEach(w=>{
    const b=document.createElement('button');
    b.className='choice';
    b.textContent=w;
    b.onclick=()=>answer(w);
    box.appendChild(b);
  });
}

function playerAttack(){
  const base=state.baseATK;
  const v=Math.max(1,Math.floor(base*0.5));
  return base+rand(v+1);
}
function enemyAttack(){
  const e=state.enemy;
  return e.atkMin+rand(e.atkMax-e.atkMin+1);
}

function answer(choice){
  if(!currentQ) return;
  [...document.querySelectorAll('button.choice')].forEach(b=>b.disabled=true);
  if(choice===currentQ.ans){
    const dmg=playerAttack();
    state.enemy.hp=clamp(state.enemy.hp-dmg,0,state.enemy.maxHP);
    log(`âœ… æ­£è§£ï¼ <span class="ok">${dmg} ãƒ€ãƒ¡ãƒ¼ã‚¸</span>`);
    updateEnemyHUD();
  }else{
    const dmg=enemyAttack();
    state.hp=clamp(state.hp-dmg,0,state.maxHP);
    const bar=document.getElementById('hpBar');
    if(bar){ bar.classList.add('blink'); setTimeout(()=>bar.classList.remove('blink'),260); }
    log(`âŒ ä¸æ­£è§£â€¦ <span class="bad">${dmg} ãƒ€ãƒ¡ãƒ¼ã‚¸</span>`);
  }
  renderHUD();
  checkEnd();
  if(!isBattleOver()) setTimeout(nextQuestion,300);
}

function isBattleOver(){ return state.hp<=0 || state.enemy.hp<=0; }
function checkEnd(){
  const nextBtn=document.getElementById('nextBtn');
  const retryBtn=document.getElementById('retryBtn');
  if(state.enemy.hp<=0){
    log(`ğŸ† <span class="ok">æ’ƒç ´ï¼</span> +${state.enemy.xp} EXP`);
    addExp(state.enemy.xp);
    nextBtn.style.display='inline-block';
    retryBtn.style.display='none';
  }else if(state.hp<=0){
    log('<span class="bad">å€’ã‚Œã¦ã—ã¾ã£ãŸâ€¦</span>');
    nextBtn.style.display='none';
    retryBtn.style.display='inline-block';
  }
}

function nextEnemy(){
  state.enemyIndex=(state.enemyIndex+1)%ENEMIES.length;
  spawnEnemy();
  nextQuestion();
  document.getElementById('nextBtn').style.display='none';
}
function retry(){
  state.hp=state.maxHP;
  renderHUD();
  spawnEnemy();
  nextQuestion();
  document.getElementById('retryBtn').style.display='none';
}

function init(){
  loadExp();
  renderHUD();
  spawnEnemy();
  nextQuestion();
  document.getElementById('nextBtn').onclick=nextEnemy;
  document.getElementById('retryBtn').onclick=retry;
}

init();
</script>
</body>
</html>

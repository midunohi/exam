<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flashcards: Astronomy Vocabulary</title>
  <style>
    :root{ --bg:#0f172a; --panel:#0a0f1a; --card:#0b1220; --border:#1f2937; --fg:#e5e7eb; --muted:#9ca3af; --acc:#22d3ee; --good:#34d399; }
    html,body{height:100%; margin:0; background: radial-gradient(70rem 60rem at 50% -10%, #0b1220 0%, var(--bg) 40%, #070b14 100%); font-family: system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;}
    .container{max-width:960px; margin:0 auto; padding:16px 16px 72px;}
    header{display:flex; gap:12px; align-items:center; justify-content:space-between; color:var(--fg); margin-top:12px}
    header .title{font-weight:800; letter-spacing:.3px; white-space:normal; word-break:break-word; line-height:1.25}
    .card{margin-top:14px; background:linear-gradient(180deg,#0a1322,#0a0f1a); border:1px solid var(--border); border-radius:20px; padding:24px; display:grid; grid-template-columns:1fr; gap:16px; align-items:start; box-shadow:0 10px 30px rgba(0,0,0,.35);}    
    .term-mean{display:flex; align-items:baseline; gap:12px; flex-wrap:wrap}
    .term{font-size:36px; line-height:1.2; color:var(--fg); font-weight:800;}
    .mean{font-size:24px; color:var(--acc);} /* 答え=薄い青緑 */
    .phrases{display:flex; flex-direction:column; gap:8px}
    .phrase-line{display:flex; flex-direction:column; gap:2px; align-items:flex-start}
    .phrase-en{color:var(--fg); font-size:16px}
    /* 日本語は非表示時でも1行分の高さを保持 */
    .phrase-ja{color:var(--muted); font-size:16px; line-height:1.4; min-height:1.4em}
    .foot{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:10px; color:var(--muted); flex-wrap:wrap}
    .meters{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .meter{display:flex; align-items:center; gap:8px}
    .bar{position:relative; width:220px; height:10px; background:#0c1220; border:1px solid var(--border); border-radius:999px; overflow:hidden}
    .fill{position:absolute; inset:0; width:0%; background:linear-gradient(90deg, var(--acc), var(--good)); box-shadow:0 0 20px rgba(34,211,238,.4) inset}
    .count{font-weight:700; color:var(--fg)}
    .hint{font-size:12px; color:var(--muted)}
    a.back{color:var(--acc); text-decoration:none; font-size:14px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">Astronomy Flashcards<br/>天文学語彙フラッシュカード</div>
    </header>

    <section class="card" aria-live="polite" id="card" tabindex="0">
      <div class="term-mean">
        <div class="term" id="term">...</div>
        <div class="mean" id="meaning"></div>
      </div>
      <div class="phrases" id="phrases"></div>
      <div class="foot">
        <div class="meters" aria-live="polite">
          <div class="meter" title="この周回の進捗">
            <span class="badge">Cycle</span>
            <div class="bar" aria-label="Reveal Cycle Progress" role="progressbar" aria-valuemin="0" aria-valuemax="10" aria-valuenow="0">
              <div class="fill" id="cycleFill"></div>
            </div>
            <span class="badge" id="cycleText">0 / 10</span>
          </div>
          <div class="meter" title="トータルの表示回数">
            <span class="badge">Reveals</span>
            <span class="count" id="revealCount">0</span>
          </div>
        </div>
        <div id="progress">0 / 0</div>
        <div class="hint">タップ/クリックで答えを表示 → もう一度で次へ（Space/Enter/→も可）</div>
      </div>
    </section>
  </div>
  <div style="padding:16px; max-width:960px; margin:0 auto"><a class="back" href="index.html">戻る</a></div>

  <script>
  // --- Data: Astronomy ------------------------------------------------
  const dataset = [
    { en:'planet', ja:'惑星', phrases:[
      {en:'Earth is a rocky planet in the habitable zone.', ja:'地球はハビタブルゾーンにある岩石惑星である。'},
      {en:'Gas giants are planets composed mostly of hydrogen and helium.', ja:'巨大ガス惑星は主に水素とヘリウムから成る。'},
      {en:'A planet orbits a star and clears its neighborhood.', ja:'惑星は恒星を公転し、その軌道近傍を一掃する。'}
    ] },
    { en:'star', ja:'恒星', phrases:[
      {en:'A star produces energy through nuclear fusion.', ja:'恒星は核融合でエネルギーを生み出す。'},
      {en:'Stars are classified by their spectra and temperature.', ja:'恒星はスペクトルと温度で分類される。'},
      {en:'The Sun is a G-type main-sequence star.', ja:'太陽はG型の主系列星である。'}
    ] },
    { en:'galaxy', ja:'銀河', phrases:[
      {en:'The Milky Way is a barred spiral galaxy.', ja:'天の川銀河は棒渦巻銀河である。'},
      {en:'Galaxies contain stars, gas, dust, and dark matter.', ja:'銀河には恒星・ガス・塵・ダークマターが含まれる。'},
      {en:'Some galaxies collide and merge over time.', ja:'一部の銀河は時間とともに衝突・合体する。'}
    ] },
    { en:'nebula', ja:'星雲', phrases:[
      {en:'A nebula is a cloud of gas and dust in space.', ja:'星雲は宇宙に漂うガスと塵の雲である。'},
      {en:'New stars can form inside dense nebulae.', ja:'濃い星雲の内部で新しい恒星が形成されることがある。'},
      {en:'Emission nebulae glow due to ionized gas.', ja:'散光星雲は電離ガスの発光で輝く。'}
    ] },
    { en:'comet', ja:'彗星', phrases:[
      {en:'A comet develops a tail as it approaches the Sun.', ja:'彗星は太陽に近づくと尾を形成する。'},
      {en:'The nucleus of a comet is made of ice and dust.', ja:'彗星の核は氷と塵でできている。'},
      {en:'Comets originate from the Kuiper Belt and Oort Cloud.', ja:'彗星はカイパーベルトやオールトの雲に起源を持つ。'}
    ] },
    { en:'asteroid', ja:'小惑星', phrases:[
      {en:'Most asteroids orbit in the asteroid belt.', ja:'多くの小惑星は小惑星帯を公転している。'},
      {en:'Some asteroids are rubble piles held together by gravity.', ja:'一部の小惑星は重力でまとまった瓦礫の集まりである。'},
      {en:'Near-Earth asteroids can cross Earth’s orbit.', ja:'地球近傍小惑星は地球の軌道を横切ることがある。'}
    ] },
    { en:'meteor', ja:'流星', phrases:[
      {en:'A meteor is a streak of light in the atmosphere.', ja:'流星は大気中で光の筋として見える。'},
      {en:'Meteor showers occur when Earth passes through comet debris.', ja:'流星群は地球が彗星の残骸を通過すると発生する。'},
      {en:'A meteorite is a fragment that reaches the ground.', ja:'隕石は地表に到達した破片である。'}
    ] },
    { en:'eclipse', ja:'食（天体食）', phrases:[
      {en:'A solar eclipse occurs when the Moon blocks the Sun.', ja:'日食は月が太陽を遮るときに起こる。'},
      {en:'Totality is the brief period of complete coverage.', ja:'皆既は完全に覆われる短い時間である。'},
      {en:'Lunar eclipses happen when Earth’s shadow falls on the Moon.', ja:'月食は地球の影が月に落ちるときに起こる。'}
    ] },
    { en:'orbit', ja:'軌道', phrases:[
      {en:'Satellites maintain orbit by balancing gravity and speed.', ja:'人工衛星は重力と速度のバランスで軌道を保つ。'},
      {en:'An elliptical orbit has two focal points.', ja:'楕円軌道には二つの焦点がある。'},
      {en:'Planets follow nearly circular orbits around the Sun.', ja:'惑星は太陽の周りをほぼ円軌道で回る。'}
    ] },
    { en:'rotation', ja:'自転', phrases:[
      {en:'Earth’s rotation causes day and night.', ja:'地球の自転が昼夜を生む。'},
      {en:'Rotation period is the time for one spin.', ja:'自転周期は1回転に要する時間である。'},
      {en:'Rapid rotation can flatten a planet at the poles.', ja:'高速自転は惑星を極方向に扁平にする。'}
    ] },
    { en:'revolution', ja:'公転', phrases:[
      {en:'Earth’s revolution around the Sun takes one year.', ja:'地球が太陽を公転するのに1年かかる。'},
      {en:'Seasons result from Earth’s tilt and revolution.', ja:'季節は地軸の傾きと公転の結果である。'},
      {en:'The Moon’s revolution around Earth causes phases.', ja:'月の地球周回（公転）が位相の変化を生む。'}
    ] },
    { en:'light-year', ja:'光年', phrases:[
      {en:'A light-year measures distance, not time.', ja:'光年は時間ではなく距離の単位である。'},
      {en:'The nearest star is over four light-years away.', ja:'最も近い恒星でも4光年以上離れている。'},
      {en:'Galaxies can be millions of light-years apart.', ja:'銀河同士は数百万光年以上離れていることがある。'}
    ] },
    { en:'redshift', ja:'赤方偏移', phrases:[
      {en:'Redshift indicates objects moving away from us.', ja:'赤方偏移は天体が遠ざかっていることを示す。'},
      {en:'Cosmological redshift is due to the expansion of space.', ja:'宇宙論的赤方偏移は空間の膨張による。'},
      {en:'Spectral lines shift toward longer wavelengths.', ja:'スペクトル線は長波長側へ移動する。'}
    ] },
    { en:'spectrum', ja:'スペクトル', phrases:[
      {en:'A spectrum spreads light by wavelength.', ja:'スペクトルは光を波長ごとに分ける。'},
      {en:'Absorption lines reveal chemical composition.', ja:'吸収線は化学組成を示す。'},
      {en:'Astronomers study spectra to measure velocities.', ja:'天文学者は速度測定にスペクトルを用いる。'}
    ] },
    { en:'telescope', ja:'望遠鏡', phrases:[
      {en:'A telescope collects and magnifies light from distant objects.', ja:'望遠鏡は遠方天体からの光を集め拡大する。'},
      {en:'Space telescopes avoid atmospheric distortion.', ja:'宇宙望遠鏡は大気のゆらぎを回避できる。'},
      {en:'Radio telescopes detect long-wavelength signals.', ja:'電波望遠鏡は長波長の信号を検出する。'}
    ] },
    { en:'radiation', ja:'放射', phrases:[
      {en:'Electromagnetic radiation ranges from radio to gamma rays.', ja:'電磁放射は電波からガンマ線まで及ぶ。'},
      {en:'Solar radiation affects Earth’s climate and space weather.', ja:'太陽放射は地球の気候や宇宙天気に影響する。'},
      {en:'Ionizing radiation can damage living tissue.', ja:'電離放射線は生体組織を損傷し得る。'}
    ] },
    { en:'black hole', ja:'ブラックホール', phrases:[
      {en:'A black hole’s gravity prevents even light from escaping.', ja:'ブラックホールの重力は光さえ逃がさない。'},
      {en:'Material forms an accretion disk as it falls in.', ja:'物質は落下時に降着円盤を形成する。'},
      {en:'The event horizon marks the point of no return.', ja:'事象の地平面は戻れない境界である。'}
    ] },
    { en:'supernova', ja:'超新星', phrases:[
      {en:'A supernova is a powerful stellar explosion.', ja:'超新星は非常に強力な恒星爆発である。'},
      {en:'Supernovae enrich space with heavy elements.', ja:'超新星は重元素で宇宙を豊かにする。'},
      {en:'Type Ia supernovae are used to measure cosmic distances.', ja:'Ia型超新星は宇宙の距離測定に用いられる。'}
    ] },
    { en:'exoplanet', ja:'系外惑星', phrases:[
      {en:'An exoplanet orbits a star outside our Solar System.', ja:'系外惑星は太陽系外の恒星を回る。'},
      {en:'The transit method detects dips in starlight.', ja:'トランジット法は恒星光の減光で検出する。'},
      {en:'Some exoplanets may be in the habitable zone.', ja:'ハビタブルゾーンにある系外惑星もあるかもしれない。'}
    ] },
    { en:'constellation', ja:'星座', phrases:[
      {en:'A constellation is a recognized pattern of stars.', ja:'星座は認識された星の並びである。'},
      {en:'Constellations help map the night sky.', ja:'星座は夜空の地図作成に役立つ。'},
      {en:'Different cultures have unique constellations.', ja:'文化によって独自の星座がある。'}
    ] },
    { en:'pulsar', ja:'パルサー', phrases:[
      {en:'A pulsar is a rapidly rotating neutron star.', ja:'パルサーは高速回転する中性子星である。'},
      {en:'It emits beams of radiation like a lighthouse.', ja:'灯台のように放射ビームを放つ。'},
      {en:'Precise pulsar timing tests general relativity.', ja:'精密なパルサー計時は一般相対論を検証する。'}
    ] },
    { en:'quasar', ja:'クエーサー（準恒星状天体）', phrases:[
      {en:'A quasar is powered by a supermassive black hole.', ja:'クエーサーは超大質量ブラックホールにより駆動される。'},
      {en:'Quasars are among the brightest objects in the universe.', ja:'クエーサーは宇宙で最も明るい天体の一つである。'},
      {en:'Their redshift reveals the early universe.', ja:'その赤方偏移は初期宇宙を示す。'}
    ] },
    { en:'accretion disk', ja:'降着円盤', phrases:[
      {en:'Gas spirals inward forming an accretion disk.', ja:'ガスは内向きに渦巻き降着円盤を形成する。'},
      {en:'Friction in the disk heats the material.', ja:'円盤内の摩擦が物質を加熱する。'},
      {en:'X-rays often come from hot inner disk regions.', ja:'X線は高温の内縁部から放たれることが多い。'}
    ] },
    { en:'event horizon', ja:'事象の地平面', phrases:[
      {en:'The event horizon is the boundary around a black hole.', ja:'事象の地平面はブラックホールの境界である。'},
      {en:'No information escapes beyond this horizon.', ja:'この地平面を越えると情報は外へ出られない。'},
      {en:'Its size depends on the black hole’s mass.', ja:'その大きさはブラックホールの質量に依存する。'}
    ] },
    { en:'habitable zone', ja:'ハビタブルゾーン', phrases:[
      {en:'The habitable zone allows liquid water on a planet’s surface.', ja:'ハビタブルゾーンでは惑星表面に液体の水が存在し得る。'},
      {en:'Its location depends on the star’s luminosity.', ja:'その位置は恒星の光度に依存する。'},
      {en:'Some exoplanets lie within this zone.', ja:'この領域内にある系外惑星もある。'}
    ] },
    { en:'spectroscopy', ja:'分光法', phrases:[
      {en:'Spectroscopy splits light to analyze composition.', ja:'分光法は光を分けて組成を解析する。'},
      {en:'It measures Doppler shifts to find velocities.', ja:'ドップラー偏移の測定で速度を求める。'},
      {en:'Infrared spectroscopy can probe cool dust.', ja:'赤外分光は冷たい塵を調べられる。'}
    ] },
    { en:'magnetosphere', ja:'磁気圏', phrases:[
      {en:'Earth’s magnetosphere deflects solar wind.', ja:'地球の磁気圏は太陽風を偏向させる。'},
      {en:'Auroras occur near the magnetic poles.', ja:'オーロラは磁極付近で発生する。'},
      {en:'Strong magnetospheres can protect atmospheres.', ja:'強い磁気圏は大気を保護し得る。'}
    ] },
    { en:'solar wind', ja:'太陽風', phrases:[
      {en:'The solar wind is a stream of charged particles.', ja:'太陽風は荷電粒子の流れである。'},
      {en:'It shapes the tails of comets.', ja:'太陽風は彗星の尾の形を決める。'},
      {en:'Spacecraft must endure solar wind and radiation.', ja:'宇宙機は太陽風と放射に耐えねばならない。'}
    ] }
  ];

  // --- State -----------------------------------------------------------
  let idx = 0;
  let revealed = false;
  let revealTotal = Number(localStorage.getItem('revealTotal')||0);
  let cycleReveals = Number(sessionStorage.getItem('cycleReveals')||0);
  const cycleGoal = dataset.length; // 一周分の目標

  // --- Elements --------------------------------------------------------
  const els = {
    term: document.getElementById('term'),
    meaning: document.getElementById('meaning'),
    phrases: document.getElementById('phrases'),
    progress: document.getElementById('progress'),
    cycleFill: document.getElementById('cycleFill'),
    cycleText: document.getElementById('cycleText'),
    revealCount: document.getElementById('revealCount'),
    card: document.getElementById('card')
  };

  // --- Rendering -------------------------------------------------------
  function render(){
    const item = dataset[idx];
    els.term.textContent = item.en;
    els.meaning.textContent = revealed ? item.ja : '';
    els.phrases.innerHTML = '';
    item.phrases.forEach(p => {
      const line = document.createElement('div');
      line.className = 'phrase-line';
      const en = document.createElement('div');
      en.className = 'phrase-en';
      en.textContent = p.en;
      const ja = document.createElement('div');
      ja.className = 'phrase-ja';
      ja.textContent = p.ja;
      ja.style.visibility = revealed ? 'visible' : 'hidden';
      line.appendChild(en);
      line.appendChild(ja);
      els.phrases.appendChild(line);
    });
    els.progress.textContent = `${idx+1} / ${dataset.length}`;

    // meters
    const pct = Math.min(100, (cycleReveals / cycleGoal) * 100);
    els.cycleFill.style.width = pct + '%';
    els.revealCount.textContent = String(revealTotal);
    const bar = els.cycleFill.parentElement;
    bar.setAttribute('aria-valuemax', String(cycleGoal));
    bar.setAttribute('aria-valuenow', String(cycleReveals));
    els.cycleText.textContent = `${cycleReveals} / ${cycleGoal}`;
  }

  // --- Actions ---------------------------------------------------------
  function doReveal(){
    if(!revealed){
      revealed = true;
      revealTotal += 1;
      cycleReveals += 1;
      localStorage.setItem('revealTotal', String(revealTotal));
      sessionStorage.setItem('cycleReveals', String(cycleReveals));
      try{ if('vibrate' in navigator) navigator.vibrate(10); }catch(_){/* noop */}
      // 周回達成で軽い演出
      if(cycleReveals >= cycleGoal){
        pulseBar();
        cycleReveals = 0; // 周回をリセット
        sessionStorage.setItem('cycleReveals', '0');
      }
      render();
    } else {
      // 既に表示中→Hide
      revealed = false; render();
    }
  }

  function next(){
    if(!revealed){ doReveal(); }
    else { revealed=false; idx=(idx+1)%dataset.length; render(); }
  }
  function prev(){
    if(revealed){ revealed=false; render(); }
    else { idx=(idx-1+dataset.length)%dataset.length; render(); }
  }

  function pulseBar(){
    const el = els.cycleFill;
    el.animate([
      {filter:'brightness(1)'},
      {filter:'brightness(2)'},
      {filter:'brightness(1)'}
    ], {duration:600, easing:'ease-in-out'});
  }

  // --- Events ----------------------------------------------------------
  // タップ/クリックでReveal→次へ（従来動作）
  els.card.addEventListener('click', next);

  // キーボード操作
  window.addEventListener('keydown', e=>{
    if(['Space','Enter','ArrowRight','ArrowLeft'].includes(e.code)) e.preventDefault();
    if(e.code==='Space' || e.code==='Enter') doReveal();
    else if(e.code==='ArrowRight') next();
    else if(e.code==='ArrowLeft') prev();
  }, {passive:false});

  // --- Simple Tests (console) -----------------------------------------
  ;(function runTests(){
    const results = [];
    const assert = (name, cond)=>{ results.push({name, pass: !!cond}); console[cond? 'log':'error']((cond?'✅':'❌')+" "+name); };

    // Test 1: JA line exists & hidden when not revealed, but height reserved
    render();
    const firstJa = document.querySelector('.phrase-ja');
    assert('JA exists after initial render', !!firstJa);
    assert('JA hidden when not revealed', firstJa && firstJa.style.visibility === 'hidden');
    assert('JA reserves height (offsetHeight > 0)', firstJa && firstJa.offsetHeight > 0);

    // Test 2: doReveal toggles to visible and increments counters
    const prevTotal = Number(localStorage.getItem('revealTotal')||0);
    const prevCycle = Number(sessionStorage.getItem('cycleReveals')||0);
    doReveal();
    const firstJaAfter = document.querySelector('.phrase-ja');
    assert('JA visible after reveal', firstJaAfter && firstJaAfter.style.visibility === 'visible');
    assert('revealTotal increments', Number(localStorage.getItem('revealTotal')||0) === prevTotal + 1);
    const cyc = Number(sessionStorage.getItem('cycleReveals')||0);
    assert('cycleReveals increments or resets at goal', cyc === prevCycle + 1 || (prevCycle + 1 === cycleGoal && cyc === 0));

    // Test 3: Cycle reset behavior
    revealed = false; render();
    cycleReveals = cycleGoal - 1; sessionStorage.setItem('cycleReveals', String(cycleReveals)); render();
    doReveal(); // should reset
    assert('cycle resets to 0 at goal', Number(sessionStorage.getItem('cycleReveals')||0) === 0);

    // Clean up view
    revealed = false; render();
    console.log('Test summary:', results);
  })();

  </script>
</body>
</html>
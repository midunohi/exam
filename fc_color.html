<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>英単語フラッシュカード 色彩</title>
<style>
  :root{
    --bg:#0b0f14;--panel:#121821;--line:#223247;--ink:#e8f0f7;
    --muted:#9db2c8;--blue:#2aa6ff;--ans:#a7d4ff;--mask-fill:rgba(255,120,120,.23);--mask-line:#ff9b9b;
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;background:var(--bg);color:var(--ink)}
  .wrap{height:100%;display:grid;place-items:center;padding:16px}
  .title{position:fixed;top:10px;left:12px;right:12px;text-align:center;font-weight:800;letter-spacing:.03em;color:var(--muted)}
  .card{width:min(620px,94vw);aspect-ratio:3/2;border:1px solid var(--line);border-radius:16px;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:12px;background:var(--panel);cursor:pointer;padding:12px 16px}
  .row{display:flex;align-items:baseline;gap:12px;justify-content:center}
  .en{font-size:clamp(28px,8vw,56px);font-weight:800;white-space:nowrap}
  .jp-left{margin-left:0;text-align:left;font-size:clamp(18px,5vw,28px);opacity:.95;white-space:nowrap;border-radius:6px;padding:2px 6px}
  .examples{width:100%;max-width:560px;margin-top:4px;display:flex;flex-direction:column;gap:6px}
  .ex{font-size:clamp(14px,3.8vw,18px);line-height:1.5;border-top:1px dashed var(--line);padding:6px 0}
  .src{display:flex;gap:6px;align-items:baseline;flex-wrap:wrap}
  .tr{font-size:.95em}
  .hint{margin-top:2px;font-size:12px;color:var(--muted)}
  /* ゲージ（カード内） */
  .meter{display:flex;align-items:center;gap:10px;width:100%;max-width:560px;margin-top:auto}
  .bar{flex:1;height:8px;background:#0e1520;border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .fill{height:100%;width:0%;background:var(--blue);transition:width .25s ease}
  .count{font-size:12px;color:var(--muted);min-width:70px;text-align:right}
  /* マスク（薄い赤い四角） */
  .masked{color:transparent !important;text-shadow:none;background:var(--mask-fill);outline:1px solid var(--mask-line);border-radius:6px}
  /* 答えは薄い青 */
  .answer{color:var(--ans)}
  /* 計測用（画面外に置いて幅だけ測る）*/
  .measure{position:absolute;left:-9999px;top:-9999px;visibility:hidden;white-space:nowrap;font-size:clamp(18px,5vw,28px)}
  a.back{position:fixed;left:12px;bottom:12px;color:var(--muted)}
</style>
<body>
<div class="wrap">
  <div class="title">英単語フラッシュカード 色彩/div>
  <div class="card" id="card" aria-label="カードをタップまたはスペース/Enterで段階表示/次へ">
    <div class="row"><div class="en" id="en">—</div><div class="jp-left answer" id="jp">&nbsp;</div></div>
    <div class="examples" id="examples"></div>
    <div class="hint">タップ/Space/Enter : 答えを1つずつ表示 → すべて表示後に次の問題</div>
    <!-- カード内ゲージ＆数字（数字はここだけ） -->
    <div class="meter" aria-label="進捗ゲージ（各答えを表示すると増えます）">
      <div class="bar"><div class="fill" id="fill"></div></div>
      <div class="count"><span id="count">0</span>/<span id="total">0</span></div>
    </div>
  </div>
</div>
<a class="back" href="#" onclick="history.back();return false;">戻る</a>
<script>
'use strict';
// [英語, 日本語, 用例(英/日)の配列]
const data = [
  ['red','赤い',      [['a red apple','赤いリンゴ'],['red dress','赤いドレス']]],
  ['blue','青い',     [['blue sky','青い空'],['feel blue','憂うつだ']]],
  ['yellow','黄色い', [['yellow flower','黄色い花'],['a yellow bird','黄色い鳥']]],
  ['green','緑',      [['green leaf','緑の葉'],['go green','環境に優しい選択をする']]],
  ['orange','オレンジ色',[['orange juice','オレンジジュース'],['orange sunset','オレンジ色の夕日']]],
  ['purple','紫',     [['purple shirt','紫のシャツ'],['purple light','紫の光']]],
  ['pink','ピンク',   [['pink cheeks','ピンク色のほお'],['pink paint','ピンクの塗料']]],
  ['brown','茶色',    [['brown bag','茶色のかばん'],['brown shoes','茶色の靴']]],
  ['black','黒',      [['black cat','黒猫'],['black coffee','ブラックコーヒー']]],
  ['white','白',      [['white snow','白い雪'],['white shirt','白いシャツ']]],
  ['gray','灰色',     [['gray cloud','灰色の雲'],['gray hair','白髪/灰色の髪']]]
];

// ====== 状態 ======
let i = 0; // 現在のカード
// 各カードで何個の答えを開いたか（単語訳=1 + 例文訳数）
const stepsPer = data.map(([_, __, ex]) => 1 + (ex?.length || 0));
const revealedPer = new Array(data.length).fill(0); // 各カードの開示数
const totalSteps = stepsPer.reduce((a,b)=>a+b,0);

// DOM
const en = document.getElementById('en');
const jp = document.getElementById('jp');
const examples = document.getElementById('examples');
const fillEl = document.getElementById('fill');
const countEl = document.getElementById('count');
const totalEl = document.getElementById('total');

totalEl.textContent = String(totalSteps);

function solvedCount(){ return revealedPer.reduce((a,b)=>a+b,0); }
function updateGauge(){
  const s = solvedCount();
  countEl.textContent = String(s);
  fillEl.style.width = ((s/totalSteps)*100).toFixed(3)+'%';
}

// 日本語訳の最大幅を測って min-width 固定（英語の位置が動かない）
function fixJPMinWidth(){
  const meas = document.createElement('span');
  meas.className = 'measure';
  document.body.appendChild(meas);
  let max = 0;
  for(const [,ja] of data){
    meas.textContent = ja;
    const w = meas.getBoundingClientRect().width;
    if(w>max) max = w;
  }
  document.body.removeChild(meas);
  jp.style.minWidth = Math.ceil(max)+ 'px';
}

function renderExamples(exList, revealed){
  // exList: [[en, ja], ...]
  // revealed: 何個の答えが開いているか（カード内トータル）
  // 0 → 日本語訳未表示、1 → 日本語訳のみ表示、2以降 → 例文訳も順に表示
  const exRevealed = Math.max(0, revealed - 1); // 例文のうち表示すべき個数
  examples.innerHTML = exList.map(([e,j], idx)=>{
    const shown = idx < exRevealed;
    const jaSpan = `<span class="tr ${shown? 'answer' : 'masked'}"> — ${j}</span>`;
    return `<div class="ex"><div class="src">${e}${jaSpan}</div></div>`;
  }).join('');
}

function show(){
  const [e, j, ex] = data[i];
  en.textContent = e;
  // 日本語訳：表示済みなら青、未表示なら薄赤い四角（mask）
  const showJP = revealedPer[i] >= 1;
  jp.textContent = j;
  jp.classList.toggle('answer', showJP);
  jp.classList.toggle('masked', !showJP);
  renderExamples(ex || [], revealedPer[i]);
  updateGauge();
}

function revealOrNext(){
  const limit = stepsPer[i];
  if(revealedPer[i] < limit){
    revealedPer[i] += 1; // 1つだけ開示
    show();
  } else {
    // 次のカードへ（循環）
    i = (i + 1) % data.length;
    show();
  }
}

// キー/タップ操作
const card = document.getElementById('card');
card.addEventListener('click', revealOrNext);

document.addEventListener('keydown', e=>{
  if(e.code==='Space' || e.code==='Enter'){
    e.preventDefault();
    revealOrNext();
  }
  if(e.code==='ArrowRight'){
    e.preventDefault(); i=(i+1)%data.length; show();
  }
  if(e.code==='ArrowLeft'){
    e.preventDefault(); i=(i-1+data.length)%data.length; show();
  }
});

// 初期化
fixJPMinWidth();
show();
</script>
</body>
</html>

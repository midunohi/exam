<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>キャラステータス</title>
<style>
  :root{
    --fg:#e5e7eb;
    --hp:#ef4444; --hp2:#b91c1c;
    --exp:#38bdf8; --exp2:#0ea5e9;
  }
  *{box-sizing:border-box}
  html,body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif;
    background:#020617;
    color:var(--fg);
  }
  body{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:12px;
    background-image:url('img/bg_rpg_status.png');
    background-size:cover;
    background-position:center;
    background-repeat:no-repeat;
  }
  #wrap{
    width:100%;
    max-width:720px;
    background:rgba(15,23,42,.88);
    border-radius:16px;
    border:1px solid rgba(148,163,184,.35);
    box-shadow:0 18px 45px rgba(0,0,0,.8);
    padding:16px;
  }
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
    margin-bottom:12px;
  }
  h1{font-size:18px;margin:0}
  #backBtn{
    padding:4px 10px;
    border-radius:999px;
    border:0;
    background:#0f172a;
    color:var(--fg);
    font-size:12px;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:4px;
  }
  #backBtn span{font-size:14px}

  .card{
    background:radial-gradient(circle at top,#111827,#020617 70%);
    border-radius:14px;
    border:1px solid rgba(55,65,81,.9);
    padding:12px;
  }

  /* 上部ステータス */
  .meta{
    display:grid;
    grid-template-columns:1fr 1fr 1fr;
    gap:8px;
    margin-bottom:10px;
  }
  .pill{
    padding:6px 10px;
    border-radius:999px;
    background:#0f172a;
    border:1px solid rgba(148,163,184,.5);
    font-size:12px;
    display:flex;
    justify-content:space-between;
    gap:8px;
    font-variant-numeric:tabular-nums;
  }
  .pill span:first-child{opacity:.8}

  .row{
    display:flex;
    align-items:center;
    gap:8px;
    margin-bottom:8px;
    font-size:13px;
  }
  .label{width:64px;opacity:.8}
  .barWrap{
    flex:1;
    height:12px;
    border-radius:999px;
    overflow:hidden;
    background:#020617;
    border:1px solid #020617;
  }
  .barInner{height:100%;width:0;transition:width .25s}
  .barHp{background:linear-gradient(90deg,var(--hp),var(--hp2))}
  .barExp{background:linear-gradient(90deg,var(--exp),var(--exp2))}
  .barText{
    min-width:110px;
    text-align:right;
    font-size:11px;
    opacity:.9;
    font-variant-numeric:tabular-nums
  }

  /* キャラ画像：中央・大きめ（正方形想定） */
  .avatarWrap{
    display:flex;
    justify-content:center;
    margin-top:10px;
  }
  .avatar{
    width:min(320px, 72vw);
    aspect-ratio:1/1;
    border-radius:16px;
    overflow:hidden;
    border:1px solid rgba(148,163,184,.55);
    background:rgba(2,6,23,.7);
    box-shadow:0 10px 30px rgba(0,0,0,.35);
  }
  .avatar img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
</style>
</head>

<body>
<div id="wrap">
  <header>
    <h1>キャラステータス</h1>
    <button id="backBtn" type="button"><span>◀</span> ゲームにもどる</button>
  </header>

  <section class="card">

    <!-- ステータス（キャラの上部） -->
    <div class="meta">
      <div class="pill"><span>Lv</span><span id="lv">1</span></div>
      <div class="pill"><span>ATK</span><span id="atk">5</span></div>
      <div class="pill"><span>総EXP</span><span id="totalExp">0</span></div>
    </div>

    <div class="row">
      <span class="label">EXP</span>
      <div class="barWrap"><div id="expBar" class="barInner barExp"></div></div>
      <span id="expText" class="barText">0 / 20</span>
    </div>

    <div class="row">
      <span class="label">HP</span>
      <div class="barWrap"><div id="hpBar" class="barInner barHp"></div></div>
      <span id="hpText" class="barText">30 / 30</span>
    </div>

    <div class="row" style="margin-bottom:0;">
      <span class="label">次Lv</span>
      <div style="flex:1;opacity:.85;font-size:12px;">あと <b id="toNext">20</b></div>
    </div>

    <!-- キャラ（中央） -->
    <div class="avatarWrap">
      <div class="avatar">
        <img src="img/rpg_player_character.png" alt="player character">
      </div>
    </div>

  </section>
</div>

<script>
  const KEY = 'midunohi.exam.exp';
  const $ = (id)=>document.getElementById(id);
  const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));
  const setBar = (el,r)=>el && (el.style.width=(100*clamp(r,0,1)).toFixed(1)+'%');

  let lv, exp, nextExp, maxHP, atk, totalExp;

  const reset = ()=>{ lv=1; exp=0; nextExp=20; atk=5; maxHP=30; };
  const levelUp = ()=>{
    lv++;
    maxHP += 8 + Math.floor(lv*1.5);
    atk += 2;
    nextExp = Math.round(nextExp*1.35);
  };

  const load = ()=>{
    totalExp = Number(localStorage.getItem(KEY) || '0');
    if(!Number.isFinite(totalExp) || totalExp < 0) totalExp = 0;

    reset();
    let rest = totalExp;
    while(rest >= nextExp){ rest -= nextExp; levelUp(); }
    exp = rest;
  };

  const render = ()=>{
    $('lv').textContent = lv;
    $('atk').textContent = atk;
    $('totalExp').textContent = totalExp;

    $('expText').textContent = `${exp} / ${nextExp}`;
    $('hpText').textContent = `${maxHP} / ${maxHP}`;
    $('toNext').textContent = Math.max(0, nextExp - exp);

    setBar($('expBar'), exp / nextExp);
    setBar($('hpBar'), 1);
  };

  const init = ()=>{
    load(); render();
    $('backBtn').addEventListener('click', ()=>{
      if(document.referrer) history.back();
      else alert('ゲーム画面から開くと「戻る」で帰れます。');
    });
  };
  init();
</script>
</body>
</html>

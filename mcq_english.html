<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>英語 4択</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: dark; }
    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top, #433155 0, #120518 40%, #030008 100%);
      color: #f4ecff;
    }
    .container {
      max-width: 720px;
      margin: 0 auto;
      padding: 16px;
      background: rgba(8, 4, 16, 0.9);
      border-radius: 12px;
      border: 1px solid rgba(190, 140, 255, 0.6);
      box-shadow: 0 0 30px rgba(120, 60, 200, 0.6);
    }
    h1 {
      margin: 0 0 8px;
      font-size: 1.3rem;
      letter-spacing: 0.08em;
      text-shadow: 0 0 6px #b68cff;
    }
    .meta {
      font-size: 0.9rem;
      color: #c8b4ff;
      margin-bottom: 12px;
    }
    .question {
      font-size: 1rem;
      margin-bottom: 12px;
      white-space: pre-wrap;
      padding: 8px 10px;
      border-radius: 8px;
      background: rgba(16, 8, 40, 0.9);
      border: 1px solid rgba(160, 120, 255, 0.5);
    }
    .choices {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 12px;
    }
    .choice-btn {
      text-align: left;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid rgba(120, 90, 190, 0.8);
      background: rgba(10, 6, 24, 0.9);
      color: inherit;
      cursor: pointer;
      font-size: 0.95rem;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.08s ease;
    }
    .choice-btn:hover:not(.disabled) {
      transform: translateY(-1px);
      box-shadow: 0 0 12px rgba(180, 130, 255, 0.8);
      background: radial-gradient(circle at top left, #2a163f, #0a0618 60%);
    }
    .choice-btn.correct {
      background: radial-gradient(circle at top, #14522f, #071710 60%);
      border-color: #42d37f;
      box-shadow: 0 0 14px rgba(66, 211, 127, 0.8);
    }
    .choice-btn.wrong {
      background: radial-gradient(circle at top, #5b1422, #190609 60%);
      border-color: #ff5b7f;
      box-shadow: 0 0 14px rgba(255, 91, 127, 0.8);
    }
    .choice-btn.disabled { opacity: 0.7; cursor: default; }
    .feedback {
      min-height: 1.5em;
      font-size: 0.95rem;
      margin-bottom: 8px;
      color: #ffe6ff;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
      font-size: 0.9rem;
    }
    #nextBtn {
      padding: 6px 16px;
      border-radius: 999px;
      border: 1px solid rgba(200, 160, 255, 0.9);
      background: radial-gradient(circle at top, #7a3dff, #3c1280 60%);
      color: #fff;
      cursor: pointer;
      font-size: 0.9rem;
      text-shadow: 0 0 4px rgba(0, 0, 0, 0.8);
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.08s ease;
    }
    #nextBtn:hover:enabled {
      transform: translateY(-1px);
      box-shadow: 0 0 14px rgba(200, 160, 255, 0.9);
      background: radial-gradient(circle at top, #9c5fff, #4a19a0 60%);
    }
    #nextBtn:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      background: #3b3450;
    }
    #result {
      margin-top: 12px;
      font-size: 0.95rem;
      border-top: 1px solid rgba(180, 140, 255, 0.4);
      padding-top: 8px;
      color: #e0d4ff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>英語 4択</h1>
    <div class="meta" id="status"></div>
    <div class="question" id="question"></div>
    <div class="choices" id="choices"></div>
    <div class="feedback" id="feedback"></div>
    <div class="controls">
      <div id="score"></div>
      <button id="nextBtn" disabled>次へ</button>
    </div>
    <div id="result"></div>
  </div>

  <script>
    const questions = [
      {
        text: "He finally managed to ______ his fear of speaking in public.",
        choices: ["overcome", "occupy", "obtain", "overlook"],
        correctIndex: 0,
        explanation: "『恐怖を克服する』は overcome one's fear と言う。"
      },
      {
        text: "If he ______ earlier, he wouldn’t have missed the train.",
        choices: ["leaves", "left", "had left", "would leave"],
        correctIndex: 2,
        explanation: "仮定法過去完了: If + 過去完了, would have + 過去分詞。"
      },
      {
        text: "I couldn’t make ______ what he was saying because of the noise.",
        choices: ["out", "up", "for", "off"],
        correctIndex: 0,
        explanation: "make out A = Aを理解する。"
      },
      {
        text: "The book is worth ______.",
        choices: ["to read", "reading", "to be read", "read"],
        correctIndex: 1,
        explanation: "be worth ~ing = 〜する価値がある。"
      },
      {
        text: "A: Could you give me a hand with this box?\nB: ______",
        choices: ["Yes, here you are.", "Sure, no problem.", "I’d rather not say so.", "Help yourself."],
        correctIndex: 1,
        explanation: "手伝いを頼まれて自然なのは “Sure, no problem.”。"
      },
      {
        text: "He insisted ______ paying for the meal.",
        choices: ["on", "for", "at", "about"],
        correctIndex: 0,
        explanation: "insist on ~ で on + 動名詞。"
      },
      {
        text: "The experiment was a success, ______ the initial concerns about safety.",
        choices: ["despite", "because", "except", "along with"],
        correctIndex: 0,
        explanation: "despite ~ = 〜にもかかわらず。"
      },
      {
        text: "\"vital\" is closest in meaning to ______.",
        choices: ["ordinary", "essential", "temporary", "pleasant"],
        correctIndex: 1,
        explanation: "vital = essential（不可欠な）。"
      },
      {
        text: "I would rather you ______ here tomorrow.",
        choices: ["come", "came", "will come", "had come"],
        correctIndex: 1,
        explanation: "would rather S + 過去形 = Sに〜してほしい。"
      },
      {
        text: "The shop is closed ______ Sundays.",
        choices: ["at", "for", "in", "on"],
        correctIndex: 3,
        explanation: "曜日の前には on: on Sundays。"
      }
    ];

    const statusEl = document.getElementById("status");
    const questionEl = document.getElementById("question");
    const choicesEl = document.getElementById("choices");
    const feedbackEl = document.getElementById("feedback");
    const scoreEl = document.getElementById("score");
    const nextBtn = document.getElementById("nextBtn");
    const resultEl = document.getElementById("result");

    const EXP_KEY = "midunohi.exam.exp";
    let exp = Number(localStorage.getItem(EXP_KEY) || 0);

    let currentIndex = 0;
    let score = 0;
    let answered = false;

    function updateStatus() {
      statusEl.textContent = `問題 ${currentIndex + 1} / ${questions.length} ｜ EXP: ${exp}`;
    }

    function renderQuestion() {
      const q = questions[currentIndex];
      answered = false;
      feedbackEl.textContent = "";
      resultEl.textContent = "";
      nextBtn.disabled = true;

      updateStatus();
      questionEl.textContent = q.text;
      scoreEl.textContent = `スコア: ${score}`;

      choicesEl.innerHTML = "";
      q.choices.forEach((choice, i) => {
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        btn.textContent = `${String.fromCharCode(65 + i)}. ${choice}`;
        btn.addEventListener("click", () => handleChoice(i));
        choicesEl.appendChild(btn);
      });
    }

    function handleChoice(index) {
      if (answered) return;
      answered = true;
      const q = questions[currentIndex];
      const buttons = choicesEl.querySelectorAll(".choice-btn");

      buttons.forEach((btn, i) => {
        btn.classList.add("disabled");
        if (i === q.correctIndex) btn.classList.add("correct");
        if (i === index && i !== q.correctIndex) btn.classList.add("wrong");
      });

      if (index === q.correctIndex) {
        score++;
        exp += 2;
        feedbackEl.textContent = "正解！ (+2 EXP)";
      } else {
        exp += 1;
        feedbackEl.textContent = `不正解… 正解は ${String.fromCharCode(65 + q.correctIndex)}. ${q.choices[q.correctIndex]}。 (+1 EXP)`;
      }

      localStorage.setItem(EXP_KEY, exp);
      updateStatus();
      scoreEl.textContent = `スコア: ${score}`;
      nextBtn.disabled = false;
      nextBtn.textContent = currentIndex === questions.length - 1 ? "結果" : "次へ";
    }

    nextBtn.addEventListener("click", () => {
      if (!answered) return;
      if (currentIndex < questions.length - 1) {
        currentIndex++;
        renderQuestion();
      } else {
        showResult();
      }
    });

    function showResult() {
      const total = questions.length;
      const percent = Math.round((score / total) * 100);
      resultEl.textContent = `お疲れさまでした。${total}問中${score}問正解（${percent}%）。累計 EXP: ${exp}`;
    }

    renderQuestion();
  </script>
</body>
</html>
